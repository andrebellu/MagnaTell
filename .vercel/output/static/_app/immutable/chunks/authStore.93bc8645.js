import{p as k,q as U,v as p,l,d as o,w as E,y as S,i as m,z as P,A as T,G as b,a,h as d,_ as u,x as v,s as h,t as g,B as q,n as w,C as A,E as O,e as f,f as y,k as x,F as I,r as R,b as C}from"./firebase.client.582fe9c6.js";import{g as D}from"./navigation.b496e749.js";async function c(e,s,t){return await fetch(e,{method:s,body:JSON.stringify(t)})}const N="https://api.dicebear.com/5.x/adventurer-neutral/svg?seed="+Math.random(),V={login:async(e,s,t)=>{const n=(await k(a,e,s).catch(i=>{i.code==="auth/account-exists-with-different-credential"?alert("You have already signed up with a different auth provider for that email."):alert("The email or password is incorrect")}))._tokenResponse.idToken;await c("/api/cookies","POST",{idToken:n,remember:t})},signup:async(e,s,t)=>{const r=await U(a,e,s).catch(i=>{i.code==="auth/email-already-in-use"&&alert("Email already in use")});await p(l(o,"users",r.user.uid),{username:t,email:e,createdAt:new Date().toISOString()}),await E(r.user,{displayName:t});const n=await S(r.user,!0);await c("/api/cookies","POST",{idToken:n}),m(r.user).then(()=>{console.log("Email sent")}).catch(i=>{console.log(i)})},logout:async()=>{await P(a),await c("/api/cookies","DELETE")},loginGoogle:async()=>{const s=(await T(a,new b).catch(i=>{console.log(i.customData)}))._tokenResponse.idToken;await c("/api/cookies","POST",{idToken:s,remember:!0});const r=d(h(o,"users"),u(v(),"==",a.currentUser.uid));(await g(r)).length!=1&&await p(l(o,"users",a.currentUser.uid),{username:a.currentUser.displayName,email:a.currentUser.email,createdAt:new Date().toISOString()})},resetPassword:async()=>{await q(a,a.currentUser.email).then(()=>{alert(`Password reset email sent
Check your inbox (and spam folder)`)}).catch(e=>{console.log(e)})},sendVerificationEmail:async()=>{await m(a.currentUser).then(()=>{alert(`Verification email sent
Check your inbox (and spam folder)`)}).catch(e=>{console.log(e)})},deleteAccount:async()=>{await w(l(o,"users",a.currentUser.uid)).catch(e=>{console.log(e)}),await A(a.currentUser).then(()=>{alert("Account deleted"),D("/login")}).catch(e=>{console.log(e)})},deleteUserRecipes:async()=>{(await g(d(h(o,"recipes"),u("uid","==",a.currentUser.uid)))).forEach(async s=>{await w(s.ref)})},deleteUserRating:async()=>{let e=[];O(f(y,"recipes-grade/")).then(s=>{s.exists()&&(e=Object.keys(s.val())),e.forEach(t=>{x(f(y,"recipes-grade/"+t+"/stars/"+a.currentUser.uid))})})},deleteUserImage:async()=>{(await g(d(h(o,"recipes"),u("uid","==",a.currentUser.uid)))).forEach(async s=>{I(R(C,"recipes-covers/"+s.id))})}};export{V as a,N as d};
